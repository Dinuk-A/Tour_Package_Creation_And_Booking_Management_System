<!DOCTYPE html>
<html lang="en">

<head th:replace="~{thymeleafFrs :: commonHeadFr}"></head>

<head>

    <!-- link employee css -->
    <!--<link rel="stylesheet" href="css/booking.css">-->

    <!-- link booking js -->
    <script src="controllerJSs/booking.js"></script>

</head>

<body>

    <header th:replace="~{thymeleafFrs :: headerFragment}"></header>
    <aside th:replace="~{thymeleafFrs :: asideFragment}"></aside>
    <div th:replace="~{thymeleafFrs :: userInfoEditModalFragment}"></div>
    <div th:replace="~{thymeleafFrs :: customAlertFragment}"></div>

    <main id="mainAreaID" class="main min-vh-100 mx-auto">

        <!-- Tabs navigation panel -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <!-- for table side -->
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="table-tab" data-bs-toggle="tab" href="#tableBookingHolderDiv" role="tab"
                    aria-controls="tableBookingHolderDiv" aria-selected="true">Table</a>
            </li>
            <!-- for form side -->
            <li class="nav-item" role="presentation">
                <a class="disabled nav-link" id="form-tab" data-bs-toggle="tab" href="#formBookingHolderDiv" role="tab"
                    aria-controls="formBookingHolderDiv" aria-selected="false" onclick="setBookingStatusAuto()">Form</a>
            </li>
        </ul>

        <!-- Tabs content -->
        <div class="tab-content mt-1" id="myTabContent">

            <!-- Table tab  -->
            <div id="tableBookingHolderDiv" class="tab-pane fade show active table-container p-4 rounded-3"
                role="tabpanel" aria-labelledby="table-tab">
                <!-- a table will be dynamically generated in here -->
            </div>

            <!-- Form tab -->
            <div class="tab-pane fade" id="formBookingHolderDiv" role="tabpanel" aria-labelledby="form-tab">
                <div class="card mx-auto" style="width: 1100px;">
                    <div class="card-header bg-primary text-white text-center">
                        <h3 class="mb-0">Booking Management Form</h3>
                    </div>
                    <div class="card-body" style="background-color: ivory;">

                        <!-- form starts -->
                        <form id="formBooking" class="" onsubmit="return false">

                            <!-- Tabs Navigation -->
                            <ul class="nav nav-tabs" id="bookingTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link active border border-dark" id="bookingStep1-tab"
                                        data-bs-toggle="tab" href="#bookingStep1" role="tab"
                                        aria-controls="bookingStep1" aria-selected="true">Basics</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link border border-dark" id="bookingStep2-tab" data-bs-toggle="tab"
                                        href="#bookingStep2" role="tab" aria-controls="bookingStep2"
                                        aria-selected="false">Resources Allocation</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link border border-dark" id="bookingStep3-tab" data-bs-toggle="tab"
                                        href="#bookingStep3" role="tab" aria-controls="bookingStep3"
                                        aria-selected="false">Additional Info</a>
                                </li>
                            </ul>

                            <!-- Tabs Content -->
                            <div class="tab-content" id="bookingTabsContent">

                                <!-- Step 1 -->
                                <div class="tab-pane fade show active" id="bookingStep1" role="tabpanel"
                                    aria-labelledby="bookingStep1-tab">

                                    <!-- Basic Info -->
                                    <fieldset class="border border-dark p-4 mb-4 bg-light">
                                        <legend class="float-none w-auto px-2 text-primary">Booking Information</legend>

                                        <div class="row">
                                            <div class=" col-md-12">

                                                <div class="row mb-2">

                                                    <div class="col-md-4">
                                                        <label for="inputBookingCode"
                                                            class="fw-bold form-label mb-0">Booking
                                                            ID<span class="text-danger"> * </span> :</label>
                                                        <input id="inputBookingCode" type="text"
                                                            class="  form-control form-input" disabled>
                                                    </div>

                                                    <div class="col-8">
                                                        <label for="selectBookedPackage" class="fw-bold">Booked Package
                                                            <span class="text-danger"> * </span>: </label>
                                                        <select id="selectBookedPackage"
                                                            class="form-control form-select" disabled>
                                                        </select>
                                                    </div>

                                                    <!-- onchange="dynamicSelectValidator(this , 'booking','tpkg')" -->
                                                    <!--onkeyup="inputValidatorText(this,'','booking','bookingcode')"-->

                                                    <!--<div class="col-3">
                                                        <label for="selectBasedInquiry" class="fw-bold">Based Inquiry
                                                            <span class="text-danger"> * </span>: </label>
                                                        <select id="selectBasedInquiry" class="form-control form-select"
                                                            disabled
                                                            onchange="dynamicSelectValidator(this , 'booking','basedinquiry_id')"
                                                            required>
                                                        </select>
                                                    </div>-->

                                                </div>

                                                <div class="row mb-2">
                                                    <div class="col-6">
                                                        <label for="inputClientName" class="fw-bold form-label mb-0">
                                                            Client
                                                            Name <span class="text-danger"> * </span>
                                                            :</label>
                                                        <input id="inputClientName" type="text"
                                                            class="form-control form-input" disabled
                                                            onkeyup="inputValidatorText(this,'','booking','clientname')"
                                                            required>
                                                    </div>

                                                    <div class="col-6">
                                                        <label class="fw-bold mb-0" for="inputClientPassport">Passport
                                                            No <span class="text-danger"> * </span>:</label>
                                                        <input id="inputClientPassport" type="text"
                                                            class="form-control form-input" disabled
                                                            onkeyup="inputValidatorText(this,'','booking','clientpassport')"
                                                            required>
                                                    </div>

                                                </div>

                                                <div class="row mb-2">

                                                    <div class="col-6">
                                                        <label class="fw-bold  mb-0" for="inputClientEmail">Email <span
                                                                class="text-danger"> * </span>:</label>
                                                        <input id="inputClientEmail" type="email"
                                                            class="form-control form-input" disabled
                                                            onkeyup="inputValidatorText(this,'','booking','clientemail')"
                                                            required>
                                                    </div>

                                                    <div class="col-3">
                                                        <label class="fw-bold  mb-0" for="inputClientContact">Contact
                                                            <span class="text-danger"> * </span>:</label>
                                                        <input id="inputClientContact" type="text"
                                                            class="form-control form-input" disabled
                                                            onkeyup="inputValidatorText(this,'','booking','clientcontact')"
                                                            required>
                                                    </div>

                                                    <div class="col-3">
                                                        <label class="fw-bold mb-0" for="inputClientContact2">Contact
                                                            2:</label>
                                                        <input id="inputClientContact2" type="text"
                                                            class="form-control form-input" disabled
                                                            onkeyup="inputValidatorText(this,'','booking','clientcontact2')">
                                                    </div>


                                                </div>


                                            </div>
                                        </div>

                                    </fieldset>

                                    <!-- financial Info -->
                                    <fieldset class="border border-dark p-4 mb-4 bg-light">
                                        <legend class="float-none w-auto px-2 text-primary">Financial Information
                                        </legend>

                                        <!-- amounts -->
                                        <div class="row mb-2">
                                            <div class="col-md-12">
                                                <div class="row mb-2">

                                                    <div class="col-3">
                                                        <label class="fw-bold  mb-0" for="inputPackagePrice">Package
                                                            Price <span class="text-danger"> * </span>:</label>

                                                        <div class="input-group">
                                                            <span class="input-group-text p-1 pb-0">
                                                                <h6 class="my-auto">LKR</h6>
                                                            </span>
                                                            <input type="text" id="inputPackagePrice"
                                                                class="form-control form-input w-85 p-1 text-center"
                                                                disabled
                                                                onkeyup="inputValidatorText(this,'^(?!0+$)\\d+(\\.\\d{1,2})?','booking','packageprice')"
                                                                onblur="insertDecimals(this);">
                                                        </div>
                                                    </div>

                                                    <div class="col-3">
                                                        <label class="fw-bold  mb-0"
                                                            for="inputAdvancementAmount">Advancement
                                                            Amount <span class="text-danger"> * </span>:</label>

                                                        <div class="input-group">
                                                            <span class="input-group-text p-1 pb-0">
                                                                <h6 class="my-auto">LKR</h6>
                                                            </span>
                                                            <input type="text" id="inputAdvancementAmount"
                                                                class="form-control form-input w-85 p-1 text-center"
                                                                disabled
                                                                onkeyup="inputValidatorText(this,'^(?!0+$)\\d+(\\.\\d{1,2})?','booking','advancementamount')"
                                                                onblur="insertDecimals(this);">
                                                        </div>

                                                        <div id="advancementFullMsg"
                                                            class="alert alert-success mt-2 py-1 px-2 fw-bold text-center d-none">
                                                            Advancement fully paid
                                                        </div>
                                                    </div>

                                                    <div class="col-3">
                                                        <label class="fw-bold  mb-0" for="inputTotalPaidAmount">Total
                                                            Paid
                                                            Amount <span class="text-danger"> * </span>:</label>

                                                        <div class="input-group">
                                                            <span class="input-group-text p-1 pb-0">
                                                                <h6 class="my-auto">LKR</h6>
                                                            </span>
                                                            <input type="text" id="inputTotalPaidAmount"
                                                                class="form-control form-input w-85 p-1 text-center"
                                                                disabled
                                                                onkeyup="inputValidatorText(this,'^(?!0+$)\\d+(\\.\\d{1,2})?','booking','totalpaidamount')"
                                                                onblur="insertDecimals(this);">
                                                        </div>

                                                        <div id="totalPaidFullMsg"
                                                            class="alert alert-success mt-2 py-1 px-2 fw-bold text-center d-none">
                                                            Full payment received
                                                        </div>

                                                    </div>

                                                    <div class="col-3">
                                                        <label class="fw-bold  mb-0" for="inputDueBalance">Balance <span
                                                                class="text-danger"> * </span>:</label>

                                                        <div class="input-group">
                                                            <span class="input-group-text p-1 pb-0">
                                                                <h6 class="my-auto">LKR</h6>
                                                            </span>
                                                            <input type="text" id="inputDueBalance"
                                                                class="form-control form-input w-85 p-1 text-center"
                                                                disabled
                                                                onkeyup="inputValidatorText(this,'^(?!0+$)\\d+(\\.\\d{1,2})?','booking','balance')"
                                                                onblur="insertDecimals(this);">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- status -->
                                        <div class="row mb-1">

                                            <div class="col-6">
                                                <label for="selectPaymentStatus" class="fw-bold form-label mb-0">
                                                    Payment Status <span class="text-danger"> * </span> :
                                                </label>

                                                <select disabled id="selectPaymentStatus"
                                                    class="form-control form-select"
                                                    onchange="staticSelectValidator(this, 'booking', 'payment_status')">
                                                    <option value="" selected disabled>Please Select Payment
                                                        Status</option>
                                                    <option value="Payment_Pending">Payment Pending</option>
                                                    <option value="Partially_Paid">Partially Paid</option>
                                                    <option value="Advance_Paid">Advancement Paid</option>
                                                    <option value="Fully_Paid">Fully Paid</option>
                                                </select>
                                            </div>

                                            <!-- button for add surcharge amount -->
                                            <div class="col-6">
                                                <button type="button" class="btn btn-primary w-100"
                                                    data-bs-toggle="modal" data-bs-target="#surchargeModal">
                                                    Add Surcharge Amount
                                                </button>
                                            </div>

                                        </div>

                                        <!-- surcharge inner table row -->
                                        <div class="row mb-2">
                                            <div class="col-6">
                                                <div class="card mx-auto mb-3 shadow-sm">
                                                    <div class="card-header fw-bold">
                                                        Surcharge List
                                                    </div>
                                                    <div class="card-body px-1 py-3">
                                                        <table class="table table-bordered mb-0">
                                                            <thead class="table-light">
                                                                <tr>
                                                                    <th>ID</th>
                                                                    <th>Reason</th>
                                                                    <th>Amount (LKR)</th>
                                                                    <th class="text-center">Action</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="surchargeTableBody">
                                                                <!-- Rows will be dynamically added here -->
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>


                                    </fieldset>

                                    <!-- Booking Timeline -->
                                    <fieldset class="border border-dark p-4 mb-4 bg-light">
                                        <legend class="float-none w-auto px-2 text-primary">Booking Timeline</legend>

                                        <div class="row">

                                            <div class="col-md-12">
                                                <div class="row mb-2">

                                                    <div class="col-4">
                                                        <label for="bookingStartDate"
                                                            class="fw-bold form-label mb-0">Start Date
                                                            <span class="text-danger"> * </span> : </label>
                                                        <input id="bookingStartDate" type="date"
                                                            class="  form-control form-input" disabled
                                                            onchange="handleStartDateChange();"
                                                            onkeydown="return false">
                                                    </div>

                                                    <div class="col-4">
                                                        <label for="bookingEndDate" class="fw-bold form-label mb-0">End
                                                            Date
                                                            <span class="text-danger"> * </span> : </label>
                                                        <input id="bookingEndDate" type="date"
                                                            class="  form-control form-input" disabled
                                                            onkeydown="return false"
                                                            oninput="inputValidatorText(this, '' ,'booking' , 'enddate'); getAvailableCompanyDrivers();">
                                                    </div>

                                                    <div class="col-1"></div>

                                                    <div class="col-3">
                                                        <button id="enableDaysBtn" type="button"
                                                            class="btn btn-primary mt-4" onclick="enableDates();">
                                                            Change Tour Dates
                                                        </button>
                                                    </div>

                                                </div>
                                            </div>

                                    </fieldset>

                                </div>

                                <!-- Step 2 -->
                                <div class="tab-pane fade" id="bookingStep2" role="tabpanel"
                                    aria-labelledby="bookingStep2-tab">

                                    <!-- resources assign rows -->
                                    <fieldset class="border border-dark p-4 mb-4 bg-light">

                                        <legend class="float-none w-auto px-2 text-primary">Assign Vehicle/Driver/Guide
                                        </legend>

                                        <!--//vehicle-->
                                        <h5 class="text-center text-dark fw-bold mb-0">Vehicle Assignment</h5>
                                        <div class="card col-12 mx-auto p-3 mb-3 mt-0 border border-primary">
                                            <div class="row">

                                                <!-- Left Section: Available Vehicles -->
                                                <div class="col-6 border-end">
                                                    <div class="row mb-3">
                                                        <!-- Internal Radio -->
                                                        <div class="col-6">
                                                            <input disabled type="radio" class="btn-check" name="vehicleType"
                                                                id="internalVehicleRB" autocomplete="off" checked
                                                                onchange="handleVehicleTypeChange('internal'); resetExtVehicleInputs();">
                                                            <label
                                                                class="btn btn-outline-primary w-100 fw-bold text-uppercase"
                                                                for="internalVehicleRB">Internal</label>
                                                        </div>
                                                        <!-- External Radio -->
                                                        <div class="col-6">
                                                            <input disabled type="radio" class="btn-check" name="vehicleType"
                                                                id="externalVehicleRB" autocomplete="off"
                                                                onchange="handleVehicleTypeChange('external')">
                                                            <label
                                                                class="btn btn-outline-secondary w-100 fw-bold text-uppercase"
                                                                for="externalVehicleRB">External</label>
                                                        </div>
                                                    </div>

                                                    <!-- Available Vehicles -->
                                                    <div id="availableVehiclesContainer" class="">

                                                        <div class="mt-2 mb-2">
                                                            <label for="vehicleTypesAll"
                                                                class="form-label fw-bold mb-0">Vehicle Types</label>
                                                            <select class="form-select" id="vehicleTypesAll"
                                                                onchange="filterVehisByTypeToo(this,window['currentObject']);"></select>
                                                        </div>

                                                        <label for="availableVehicles"
                                                            class="form-label fw-bold mb-0">Available Vehicles</label>
                                                        <select class="form-select mb-3" size="8"
                                                            id="availableVehicles"></select>
                                                        <button type="button" id="addIntVehiBtn" onclick="addIntVehi();"
                                                            class="btn btn-outline-primary w-100">Add
                                                            Selected Vehicle</button>
                                                    </div>

                                                    <!-- External Vehicle Form (hidden by default) -->
                                                    <div id="externalVehicleFormContainer" class="d-none">
                                                        <div class="row">
                                                            <div class="col-12 mb-3">
                                                                <label for="extVehName"
                                                                    class="form-label fw-bold mb-0">Vehicle Name <span
                                                                        class="text-danger">*</span> :</label>
                                                                <input id="extVehName" type="text" class="form-control"
                                                                    placeholder="Enter Vehicle Name" required
                                                                    onkeyup="inputValidatorText(this,'.+','externalVehicles','vehiname')">
                                                            </div>

                                                            <div class="col-6 mb-3">
                                                                <label for="extVehPlate"
                                                                    class="form-label fw-bold mb-0">Number Plate <span
                                                                        class="text-danger">*</span> :</label>
                                                                <input id="extVehPlate" type="text" class="form-control"
                                                                    placeholder="Enter Number Plate" required
                                                                    onkeyup="inputValidatorText(this,'.+','externalVehicles','numberplate')">
                                                            </div>

                                                            <div class="col-6 mb-3">
                                                                <label for="extVehitype"
                                                                    class="form-label mb-0 fw-bold">
                                                                    Vehicle Type</label>
                                                                <select id="extVehitype" class="form-select"
                                                                    onchange=" dynamicSelectValidator(this, 'externalVehicles','vehicletype_id'); ;">
                                                                </select>
                                                            </div>

                                                            <div class="col-12 mb-3">
                                                                <label for="extVehProviderName"
                                                                    class="form-label fw-bold mb-0">Provider Name <span
                                                                        class="text-danger">*</span> :</label>
                                                                <input id="extVehProviderName" type="text"
                                                                    class="form-control"
                                                                    placeholder="Enter Provider Full Name"
                                                                    onkeyup="inputValidatorText(this,'^([A-Z][a-z]{2,20}[\\s])+([A-Z][a-z]{2,20})$','externalVehicles','providername')"
                                                                    required>
                                                            </div>

                                                            <div class="col-6 mb-3">
                                                                <label for="extVehProviderContact"
                                                                    class="form-label fw-bold mb-0">Provider Contact
                                                                    <span class="text-danger">*</span> :</label>
                                                                <input id="extVehProviderContact" type="text"
                                                                    class="form-control" placeholder="Enter Contact"
                                                                    onkeyup="inputValidatorText(this,'','externalVehicles','providercontactone')"
                                                                    required>
                                                            </div>

                                                            <div class="col-6 mb-3">
                                                                <label for="extVehProviderEmail"
                                                                    class="form-label fw-bold mb-0">Provider Email <span
                                                                        class="text-danger">*</span> :</label>
                                                                <input id="extVehProviderEmail" type="text"
                                                                    class="form-control"
                                                                    placeholder="Enter Email Address"
                                                                    onkeyup="inputValidatorText(this,'^[A-Za-z0-9\\-\\_]{4,30}[@][a-z]{3,20}[.][a-z]{2,3}$','externalVehicles','providercontactemail')"
                                                                    required>
                                                            </div>

                                                            <div class="col-12 mt-2">
                                                                <button type="button" id="btnAddExtVehicleBtnContainer"
                                                                    class="btn btn-outline-success w-100"
                                                                    onclick="addExternalVehicle();">Add External
                                                                    Vehicle</button>
                                                            </div>

                                                            <div class="col-12 mt-2 d-none"
                                                                id="btnUpdateExtVehicleBtnContainer">
                                                                <button type="button"
                                                                    class="btn btn-outline-primary w-100"
                                                                    onclick="updateExternalVehicle();">
                                                                    Update External Vehicle
                                                                </button>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Right Section: Assigned Vehicles -->
                                                <div class="col-6">
                                                    <!-- show selected vehicles -->
                                                    <div class="mb-3" id="assignedVehicles">

                                                        <!-- selected internal vehis -->
                                                        <div class="p-3 mb-3 border border-primary rounded bg-light">
                                                            <label for="selectedIntVehis"
                                                                class="form-label fw-bold text-primary">Assigned Company
                                                                Vehicles</label>
                                                            <div class="row g-2" id="selectedIntVehis">
                                                                <!-- internal vehicles will be inserted here -->
                                                            </div>
                                                        </div>

                                                        <!-- selected external vehis -->
                                                        <div class="p-3 border border-secondary  rounded bg-light">
                                                            <label for="selectedExtVehis"
                                                                class="form-label fw-bold text-secondary ">Assigned
                                                                Rented
                                                                Vehicles</label>
                                                            <div class="row g-2" id="selectedExtVehis">
                                                                <!-- external vehicles will be inserted here -->
                                                            </div>
                                                        </div>

                                                    </div>

                                                    <!-- vehicle preference msg -->
                                                    <div class="row my-2" id="vehiclePreferenceMsg">
                                                        <div class="col-12">
                                                            <div class="alert alert-info mb-0 py-2 px-3">
                                                                <strong>Transport method preferred by customer:</strong>
                                                                <span id="preferredTransportMethod"></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!--/add the inquiry's vehi type note too-->

                                                </div>

                                            </div>
                                        </div>

                                        <!-- //driver-->
                                        <h5 class="text-center text-dark fw-bold mb-0">Driver Assignment</h5>
                                        <div class="card col-12 mx-auto p-3 mb-3 mt-0 border border-primary">
                                            <div class="row">
                                                <!-- Left Section: Available Drivers -->
                                                <div class="col-6 border-end">
                                                    <div class="row mb-3">
                                                        <!-- Internal Radio -->
                                                        <div class="col-6">
                                                            <input disabled type="radio" class="btn-check"
                                                                name="driverType" id="internalDriverRB"
                                                                autocomplete="off" checked
                                                                onchange="handleDriverTypeChange('internal'); resetExtDriverInputs();">
                                                            <label
                                                                class="btn btn-outline-primary w-100 fw-bold text-uppercase"
                                                                for="internalDriverRB">Internal</label>
                                                        </div>
                                                        <!-- External Radio -->
                                                        <div class="col-6">
                                                            <input disabled type="radio" class="btn-check"
                                                                name="driverType" id="externalDriverRB"
                                                                autocomplete="off"
                                                                onchange="handleDriverTypeChange('external')">
                                                            <label
                                                                class="btn btn-outline-secondary w-100 fw-bold text-uppercase"
                                                                for="externalDriverRB">External</label>
                                                        </div>
                                                    </div>

                                                    <!-- Available Drivers -->
                                                    <div id="availableDriversContainer">
                                                        <label for="availableDrivers"
                                                            class="form-label fw-bold mb-0">Available Drivers</label>
                                                        <select class="form-select mb-3" size="8"
                                                            id="availableDrivers"></select>
                                                        <button type="button" class="btn btn-outline-primary w-100"
                                                            id="addIntDriverBtn" onclick="addIntDrv();">Add
                                                            Selected Driver</button>
                                                    </div>

                                                    <!-- External Driver Form (hidden by default) -->
                                                    <div id="externalDriverFormContainer" class="d-none">
                                                        <div class="row">
                                                            <div class="col-12 mb-3">
                                                                <label for="extDriverFullName"
                                                                    class="form-label fw-bold mb-0">Full Name <span
                                                                        class="text-danger">*</span> :</label>
                                                                <input id="extDriverFullName" type="text"
                                                                    class="form-control"
                                                                    placeholder="Enter The Full Name"
                                                                    onkeyup="inputValidatorText(this,'^([A-Z][a-z]{2,20}[\\s])+([A-Z][a-z]{2,20})$','externalPersonnels','fullname')"
                                                                    required>
                                                            </div>

                                                            <div class="col-6 mb-3">
                                                                <label for="extDriverNIC"
                                                                    class="form-label fw-bold mb-0">NIC <span
                                                                        class="text-danger">*</span> :</label>
                                                                <input id="extDriverNIC" type="text"
                                                                    class="form-control" required
                                                                    placeholder="Enter The NIC Number"
                                                                    onkeyup="inputValidatorText(this,'^[0-9Vv]{10}$','externalPersonnels','nic')">
                                                            </div>

                                                            <div class="col-6 mb-3">
                                                                <label for="extDriverEmail"
                                                                    class="form-label fw-bold mb-0">Personal Email <span
                                                                        class="text-danger">*</span> :</label>
                                                                <input id="extDriverEmail" type="text" required
                                                                    class="form-control"
                                                                    placeholder="Enter The Personal Email Address"
                                                                    onkeyup="inputValidatorText(this,'^[A-Za-z0-9\\-\\_]{4,30}[@][a-z]{3,20}[.][a-z]{2,3}$','externalPersonnels','email')">
                                                            </div>

                                                            <div class="col-6 mb-3">
                                                                <label for="extDriverMobile"
                                                                    class="form-label fw-bold mb-0">Mobile Number <span
                                                                        class="text-danger">*</span> :</label>
                                                                <input id="extDriverMobile" type="text" required
                                                                    placeholder="Enter The Mobile Number"
                                                                    class="form-control"
                                                                    onkeyup="inputValidatorText(this, '^[0][7][01245678][0-9]{7}$', 'externalPersonnels', 'contactone'); sameContactError(this,extDriverMobile2); ">
                                                            </div>

                                                            <div class="col-6 mb-3">
                                                                <label for="extDriverMobile2"
                                                                    class="form-label fw-bold mb-0">Contact #2
                                                                    (Optional):</label>
                                                                <input id="extDriverMobile2" type="text"
                                                                    placeholder="Enter Additional Contact"
                                                                    class="form-control"
                                                                    onkeyup="inputValidatorText(this, '^[0][7][01245678][0-9]{7}$', 'externalPersonnels', 'contacttwo'); sameContactError(this,extDriverMobile); ">
                                                            </div>

                                                            <!--<div class="col-12 mb-3">
                                                                <label for="extDriverAssignedVehicle"
                                                                    class="form-label fw-bold mb-0">
                                                                    Assigned Vehicle <span class="text-danger">*</span>
                                                                    :
                                                                </label>
                                                                <select id="extDriverAssignedVehicle"
                                                                    class="form-select" required></select>
                                                            </div>-->


                                                            <div class="col-12 mt-2">
                                                                <button type="button" id="btnAddExtDriverBtnContainer"
                                                                    class="btn btn-outline-success w-100"
                                                                    onclick="addExternalDriver();">Add External
                                                                    Driver</button>
                                                            </div>

                                                            <div class="col-12 mt-2 d-none"
                                                                id="btnUpdateExtDriverBtnContainer">
                                                                <button type="button"
                                                                    class="btn btn-outline-primary w-100"
                                                                    onclick="updateExternalDriver();">
                                                                    Update External Driver
                                                                </button>
                                                            </div>

                                                        </div>
                                                    </div>

                                                </div>

                                                <!-- Right Section -->
                                                <div class="col-6">
                                                    <div class="row" id="assignedDrivers">

                                                        <!-- Assigned Internal Drivers -->
                                                        <div
                                                            class="p-3 mb-3 border border-primary rounded bg-light w-100">
                                                            <label for="selectedIntDrivers"
                                                                class="form-label fw-bold text-primary">Assigned Company
                                                                Drivers</label>
                                                            <div class="row g-2" id="selectedIntDrivers">
                                                                <!-- internal drivers will be inserted here -->
                                                            </div>
                                                        </div>

                                                        <!-- Assigned External Drivers -->
                                                        <div
                                                            class="p-3 border border-secondary  rounded bg-light w-100">
                                                            <label for="selectedExtDrivers"
                                                                class="form-label fw-bold text-secondary ">Assigned
                                                                External
                                                                Drivers</label>
                                                            <div class="row g-2" id="selectedExtDrivers">
                                                                <!-- external drivers will be inserted here -->
                                                            </div>
                                                        </div>

                                                        <!-- driver preference msg -->
                                                        <div class="row my-2" id="driverPreferenceMsg">
                                                            <div class="col-12">
                                                                <div class="alert alert-info mb-0 py-2 px-3">
                                                                    <strong>Driver preference:</strong>
                                                                    <span id="preferredDriverInfo"></span>
                                                                </div>
                                                            </div>
                                                        </div>


                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <!-- //guide -->
                                        <h5 class="text-center text-dark fw-bold mb-0">Guide Assignment</h5>
                                        <div class="card col-12 mx-auto p-3 mb-3 mt-0 border border-primary">
                                            <div class="row">
                                                <!-- Left Section: Available Guides -->
                                                <div class="col-6 border-end">
                                                    <div class="row mb-3">
                                                        <!-- Internal Radio -->
                                                        <div class="col-6">
                                                            <input disabled type="radio" class="btn-check"
                                                                name="guideType" id="internalGuideRB" autocomplete="off"
                                                                checked
                                                                onchange="handleGuideTypeChange('internal'); resetExtGuideInputs();">
                                                            <label
                                                                class="btn btn-outline-primary w-100 fw-bold text-uppercase"
                                                                for="internalGuideRB">Internal</label>
                                                        </div>
                                                        <!-- External Radio -->
                                                        <div class="col-6">
                                                            <input disabled type="radio" class="btn-check"
                                                                name="guideType" id="externalGuideRB" autocomplete="off"
                                                                onchange="handleGuideTypeChange('external')">
                                                            <label
                                                                class="btn btn-outline-secondary w-100 fw-bold text-uppercase"
                                                                for="externalGuideRB">External</label>
                                                        </div>
                                                    </div>

                                                    <!-- Available Guides -->
                                                    <div id="availableGuidesContainer">
                                                        <label for="availableGuides"
                                                            class="form-label fw-bold mb-0">Available Guides</label>
                                                        <select class="form-select mb-3" size="8"
                                                            id="availableGuides"></select>
                                                        <button type="button" id="addIntGuideBtn"
                                                            class="btn btn-outline-primary w-100"
                                                            onclick="addIntGuide();">Add
                                                            Selected Guide</button>
                                                    </div>

                                                    <!-- External Guide Form (hidden by default) -->
                                                    <div id="externalGuideFormContainer" class="d-none">
                                                        <div class="row">
                                                            <div class="col-12 mb-3">
                                                                <label for="extGuideFullName"
                                                                    class="form-label fw-bold mb-0">Full Name <span
                                                                        class="text-danger">*</span> :</label>
                                                                <input id="extGuideFullName" type="text"
                                                                    class="form-control"
                                                                    placeholder="Enter The Full Name"
                                                                    onkeyup="inputValidatorText(this,'^([A-Z][a-z]{2,20}[\\s])+([A-Z][a-z]{2,20})$','externalPersonnels','fullname')"
                                                                    required>
                                                            </div>

                                                            <div class="col-6 mb-3">
                                                                <label for="extGuideNIC"
                                                                    class="form-label fw-bold mb-0">NIC <span
                                                                        class="text-danger">*</span> :</label>
                                                                <input id="extGuideNIC" type="text" class="form-control"
                                                                    required placeholder="Enter The NIC Number"
                                                                    onkeyup="inputValidatorText(this,'^[0-9Vv]{10}$','externalPersonnels','nic')">
                                                            </div>

                                                            <div class="col-6 mb-3">
                                                                <label for="extGuideEmail"
                                                                    class="form-label fw-bold mb-0">Personal Email <span
                                                                        class="text-danger">*</span> :</label>
                                                                <input id="extGuideEmail" type="text" required
                                                                    class="form-control"
                                                                    placeholder="Enter The Personal Email Address"
                                                                    onkeyup="inputValidatorText(this,'^[A-Za-z0-9\\-\\_]{4,30}[@][a-z]{3,20}[.][a-z]{2,3}$','externalPersonnels','email')">
                                                            </div>

                                                            <div class="col-6 mb-3">
                                                                <label for="extGuideMobile"
                                                                    class="form-label fw-bold mb-0">Mobile Number <span
                                                                        class="text-danger">*</span> :</label>
                                                                <input id="extGuideMobile" type="text" required
                                                                    placeholder="Enter The Mobile Number"
                                                                    class="form-control"
                                                                    onkeyup=" inputValidatorText(this, '^[0][7][01245678][0-9]{7}$', 'externalPersonnels', 'contactone'); sameContactError(this,extGuideMobile2);">
                                                            </div>

                                                            <div class="col-6 mb-3">
                                                                <label for="extGuideMobile2"
                                                                    class="form-label fw-bold mb-0">Contact #2
                                                                    (Optional):</label>
                                                                <input id="extGuideMobile2" type="text"
                                                                    placeholder="Enter Additional Contact"
                                                                    class="form-control"
                                                                    onkeyup=" inputValidatorText(this, '^[0][7][01245678][0-9]{7}$', 'externalPersonnels', 'contacttwo'); sameContactError(this,extGuideMobile);">
                                                            </div>

                                                            <div class="col-12 mt-2">
                                                                <button type="button" id="btnAddExtGuideContainer"
                                                                    class="btn btn-outline-success w-100"
                                                                    onclick="addExternalGuide();">Add External
                                                                    Guide</button>
                                                            </div>

                                                            <div class="col-12 mt-2 d-none"
                                                                id="btnUpdateExtGuideContainer">
                                                                <button type="button"
                                                                    class="btn btn-outline-primary w-100"
                                                                    onclick="updateExternalGuide();">
                                                                    Update External Guide
                                                                </button>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Right Section -->
                                                <div class="col-6" id="assignedGuides">

                                                    <!-- Assigned Internal Guides -->
                                                    <div class="p-3 mb-3 border border-primary rounded bg-light w-100">
                                                        <label for="selectedIntGuides"
                                                            class="form-label fw-bold text-primary">
                                                            Assigned Company Guides
                                                        </label>
                                                        <div class="row g-2" id="selectedIntGuides">
                                                            <!-- internal guides will be inserted here -->
                                                        </div>
                                                    </div>

                                                    <!-- Assigned External Guides -->
                                                    <div class="p-3 border border-secondary  rounded bg-light w-100">
                                                        <label for="selectedExtGuides"
                                                            class="form-label fw-bold text-secondary ">
                                                            Assigned External Guides
                                                        </label>
                                                        <div class="row g-2" id="selectedExtGuides">
                                                            <!-- external guides will be inserted here -->
                                                        </div>
                                                    </div>

                                                    <!-- guide preference msg -->
                                                    <div class="row my-2" id="guidePreferenceMsg">
                                                        <div class="col-12">
                                                            <div class="alert alert-info mb-0 py-2 px-3">
                                                                <strong>Guide preference:</strong>
                                                                <span id="preferredGuideInfo"></span>
                                                            </div>
                                                        </div>
                                                    </div>


                                                </div>

                                            </div>
                                        </div>

                                    </fieldset>

                                </div>

                                <!-- Step 3 -->
                                <div class="tab-pane fade" id="bookingStep3" role="tabpanel"
                                    aria-labelledby="bookingStep3-tab">

                                    <!--  Additional Info -->
                                    <fieldset class="border border-dark p-4 mb-4 bg-light">
                                        <legend class="float-none w-auto px-2 text-primary">Status & Note</legend>
                                        <div class="row">

                                            <div class="col-6">

                                                <div class="row mb-1">
                                                    <div class="col-12">
                                                        <label for="selectBookingStatus"
                                                            class="fw-bold form-label mb-0">
                                                            Status <span class="text-danger"> * </span>
                                                            :</label>

                                                        <select disabled id="selectBookingStatus"
                                                            class="form-control form-select"
                                                            onchange="staticSelectValidator(this , 'booking' , 'booking_status')">
                                                            <option value="" selected disabled>Please Select Status
                                                            </option>
                                                            <option value="New">New Booking</option>
                                                            <option value="Confirmed">Confirmed </option>
                                                            <option value="Cancelled">Cancelled</option>
                                                            <option value="Completed">Completed</option>
                                                            <option value="Rescheduled">Rescheduled</option>
                                                            <option value="Refunded">Refunded</option>
                                                            <option value="ifDeleted" class="d-none"> Deleted </option>
                                                        </select>
                                                    </div>
                                                </div>

                                            </div>

                                            <div class="col-6">
                                                <label for="inputNote" class="fw-bold">Additional Information</label>
                                                <textarea id="inputNote" class="form-control" rows="5"
                                                    placeholder="Enter Any Additional Information"
                                                    onkeyup="inputValidatorText(this,'','booking','note')"></textarea>
                                            </div>


                                        </div>
                                    </fieldset>

                                    <!-- Form Buttons -->
                                    <div class="row mt-3 mb-2">

                                        <div class="col-4">
                                            <button type="reset" class="d-none btn-clear fw-bold"
                                                onclick="refreshPaymentForm();">Reset
                                                Form</button>
                                        </div>

                                        <div class="col-8 text-end">
                                            <button type="button" id="bookingUpdateBtn" class=" btn-update fw-bold "
                                                onclick="updateBooking()">Update Booking</button>

                                            <button type="submit" id="bookingAddBtn" class=" btn-add fw-bold"
                                                onclick="finalizeBooking()">Finalize Booking</button>
                                        </div>
                                    </div>

                                </div>

                            </div>

                        </form>

                    </div>

                </div>
            </div>

        </div>

        <!-- surcharge fee Modal -->
        <div class="modal fade" id="surchargeModal" tabindex="-1" aria-labelledby="surchargeModalLabel"
            aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h5 class="modal-title fw-bold" id="surchargeModalLabel">Add Surcharge</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <!-- Modal Body -->
                    <div class="modal-body">
                        <!-- Reason Field -->
                        <label class="fw-bold mb-0" for="inputSurchargeReason">
                            Reason <span class="text-danger">*</span>:
                        </label>
                        <input type="text" id="inputSurchargeReason"
                            class="form-control form-input w-100 p-1 text-center mb-3"
                            onkeyup="inputValidatorText(this,'^.{1,100}$','surcharge','reason')">

                        <!-- Amount Field -->
                        <label class="fw-bold mb-0" for="inputSurchargeAmount">
                            Amount <span class="text-danger">*</span>:
                        </label>
                        <div class="input-group">
                            <span class="input-group-text p-1 pb-0">
                                <h6 class="my-auto">LKR</h6>
                            </span>
                            <input type="text" id="inputSurchargeAmount"
                                class="form-control form-input w-85 p-1 text-center"
                                onkeyup="inputValidatorText(this,'^(?!0+$)\\d+(\\.\\d{1,2})?','surcharge','amount')"
                                onblur="insertDecimals(this);">
                        </div>
                    </div>

                    <!-- Modal Footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button id="updateSurCBtn" type="button" class="btn btn-primary"
                            onclick="updateSingleSurchargeFee()">Update</button>
                        <button id="addSurCBtn" type="button" class="btn btn-success"
                            onclick="saveSurchargeFee()">Save</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- not used -->
        <!-- Modal to display full details of a row -->
        <div class="modal fade py-5" id="infoModalVehicle" tabindex="-1" aria-labelledby="infoModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content shadow-lg rounded-4">
                    <!-- Modal Header -->
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="infoModalLabel">Yathra Vehicle Record</h5>
                        <button type="button" class="btn-close text-white" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>

                    <!-- Modal Body -->
                    <div class="modal-body bg-light">
                        <div class="container">
                            <!-- Row 1 -->
                            <div class="row mb-4 align-items-start">
                                <!-- Photo -->
                                <div class="col-md-4">
                                    <img id="modalVehiPic" src="images/vehicle.png" alt="Vehicle"
                                        class="img-thumbnail shadow-sm"
                                        style="width: 100%; max-width: 180px; height: auto;">
                                </div>

                                <!-- Type, Name, Number Plate -->
                                <div class="col-md-4">
                                    <p class="fw-bold text-primary mb-0">Vehicle Type:</p>
                                    <p id="modalVehiType" class="mb-2"></p>

                                    <p class="fw-bold text-primary mb-0">Model Name:</p>
                                    <p id="modalVehiModalName" class="mb-2"></p>

                                    <p class="fw-bold text-primary mb-0">Number Plate:</p>
                                    <p id="modalVehiNumberPlate" class="mb-2"></p>
                                </div>

                                <!-- Cost Per KM -->
                                <div class="col-md-4">
                                    <p class="fw-bold text-primary mb-0">Cost Per Kilometer:</p>
                                    <p id="modalVehiCostPerKM" class="mb-2"></p>
                                </div>
                            </div>

                            <!-- Row 2 -->
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <p class="fw-bold text-primary mb-0">Passenger Seat Count:</p>
                                    <p id="modalVehiPassengerSeatCount" class="mb-2"></p>
                                </div>
                                <div class="col-md-4">
                                    <p class="fw-bold text-primary mb-0">Max Luggage Capacity:</p>
                                    <p id="modalVehiLuggageCapacity" class="mb-2"></p>
                                </div>
                                <div class="col-md-4">
                                    <p class="fw-bold text-primary mb-0">Last Service Date:</p>
                                    <p id="modalVehiLSDate" class="mb-2"></p>
                                </div>
                            </div>

                            <!-- Row 3 -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <p class="fw-bold text-primary mb-0">Vehicle Status:</p>
                                    <p id="modalVehiStatus" class="mb-2"></p>
                                </div>
                                <div class="col-md-4">
                                    <p class="fw-bold text-primary mb-0">Additional Information:</p>
                                    <p id="modalVehiNote" class="mb-2"></p>
                                </div>
                                <div class="col-md-4">
                                    <p class="fw-bold text-danger mb-0 d-none" id="modalVehiIfDeleted"></p>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- Modal Footer -->
                    <div class="modal-footer d-flex justify-content-between bg-light">
                        <button class="btn-print fw-bold" onclick="printVehicleRecord()">
                            Print Record
                        </button>
                        <div>
                            <button id="modalVehiEditBtn" class="btn-edit me-2 fw-bold"
                                onclick="refillVehicleForm(window['currentObject'])">
                                Edit Entry
                            </button>
                            <button id="modalVehiDeleteBtn" class="btn-delete fw-bold"
                                onclick="deleteVehicleRecord(window['currentObject'])">
                                Delete Entry
                            </button>
                            <button id="modalVehiRecoverBtn" class="btn-restore d-none fw-bold"
                                onclick="restoreVehicleRecord()">
                                Restore Entry
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>
</body>

</html>